8086/87/88/186 MACRO ASSEMBLER    INITREG                                                  00:01:53  05/29/;6  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE INITREG
OBJECT MODULE PLACED IN INITREG.OBJ
ASSEMBLER INVOKED BY:  C:\WINDOWS\SYSTEM32\ASM86.EXE INITREG.ASM M1 EP DB


LOC  OBJ                  LINE     SOURCE

                             1         NAME  INITREG
                             2     ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                             3     ;                                                                            ;
                             4     ;                             INIT Registers MP3                             ;
                             5     ;                         Initialize Register Functions                      ;
                             6     ;                                   EE/CS 52                                 ;
                             7     ;                                                                            ;
                             8     ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                             9     
                            10     
                            11     ; Description:  This file contains the functions for initializing the chip 
                            12     ;               selects and control registers.
                            13     
                            14     ; Table of Contents
                            15     ;
                            16     ;   InitCS          -Initialize chip select
                            17     ;   InitCon         -Initialize the control registers
                            18     
                            19     
                            20     ; Revision History::
                            21     ;       10/27/15    Timothy Liu     initial revision
                            22     ;       10/28/15    Timothy Liu     initdisplay initializes DS
                            23     ;       10/29/15    Timothy Liu     added timer event handler
                            24     ;       11/3/15     Timothy Liu     TimerEventHandler also handles key presses
                            25     ;       11/4/15     Timothy Liu     Removed functions related to timers
                            26     ;       11/11/15    Timothy Liu     Removed function not related to chip select
                            27     ;       4/4/16      Timothy Liu     Changed name to InitCSM to distinguish from
                            28     ;                                   InitCS for EE51
                            29     ;       4/4/16      Timothy Liu     Added writing to UMCS, LMCS, and MMCS
                            30     ;       4/4/16      Timothy Liu     Removed GENERAL.INC and changed INITCS.INC
                            31     ;                                   to INITCSM.INC
                            32     ;       4/4/16      Timothy Liu     Changed name to InitReg (init registers)
                            33     ;       4/19/16     Timothy Liu     Commented out InitCon - may delete later
                            34     ;       4/20/16     Timothy Liu     Moved write to LMCS to startup.asm
                            35     ; local include files
                            36     
                            37 +1  $INCLUDE(INITREG.INC)
                      =1    38     ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      =1    39     ;                                                                            ;
                      =1    40     ;                                 initreg.INC                                ;
                      =1    41     ;                       Initialize Registers MP3 Include File                ;
                      =1    42     ;                                   EE/CS 52                                 ;
                      =1    43     ;                                                                            ;
                      =1    44     ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      =1    45     
                      =1    46     ; This file contains the definitions for initcs.asm.
                      =1    47     ;
                      =1    48     ; Revision History:
                      =1    49     ;    11/4/15     Timothy Liu     initial revision
                      =1    50     ;    11/5/15     Timothy Liu     fixed formatting
8086/87/88/186 MACRO ASSEMBLER    INITREG                                                  00:01:53  05/29/;6  PAGE    2


LOC  OBJ                  LINE     SOURCE

                      =1    51     ;    11/17/15    Timothy Liu     changed to only have values for initcs.asm
                      =1    52     ;    4/4/16      Timothy Liu     changed name to InitCSM to signify file
                      =1    53     ;                                is for 80188 MP3 player
                      =1    54     ;    4/4/16      Timothy Liu     added MMCS, LMCs UMCS reg and val definitions
                      =1    55     ;                                but no values
                      =1    56     ;    4/5/16      Timothy Liu     NOTE: control reg vals/address not added yet
                      =1    57     ;    4/19/16     Timothy Liu     wrote register addresses and control reg vals
                      =1    58     ;    5/9/16      Timothy Liu     changed MMCSval start address
                      =1    59     
                      =1    60     
                      =1    61     ; Chip Select Unit Definitions
                      =1    62     
                      =1    63     ; Addresses
  FFA4                =1    64     PACSreg         EQU     0FFA4H          ;address of PACS register
  FFA8                =1    65     MPCSreg         EQU     0FFA8H          ;address of MPCS register
  FFA6                =1    66     MMCSreg         EQU     0FFA6H          ;address of MMCS register
  FFA2                =1    67     LMCSreg         EQU     0FFA2H          ;address of LMCS register
  FFA0                =1    68     UMCSreg         EQU     0FFA0H          ;address of UMCS register
                      =1    69     
                      =1    70     ; Control Register Values
  0003                =1    71     PACSval         EQU     00003H          ;PCS base at 0, 3 wait states
                      =1    72                                             ;0000000000------  starts at address 0
                      =1    73                                             ;----------000---  reserved
                      =1    74                                             ;-------------0--  wait for RDY inputs
                      =1    75                                             ;--------------11  3 wait states
  4083                =1    76     MPCSval         EQU     04083H          ;PCS in I/O space, use PCS5/6, 3 wait states
                      =1    77                                             ;0---------000---  reserved
                      =1    78                                             ;-1000000--------  MCS is 512KB
                      =1    79                                             ;--------1-------  output PCS5/PCS6
                      =1    80                                             ;---------0------  PCS in I/O space
                      =1    81                                             ;-------------0--  wait for RDY inputs
                      =1    82                                             ;--------------11  3 wait states
                      =1    83     
  8003                =1    84     MMCSval        EQU     08003H           ;MMCS base 80000H, 3 wait states
                      =1    85                                             ;1000000---------  start address
                      =1    86                                             ;-------000000---  reserved
                      =1    87                                             ;-------------0--  enable bus ready
                      =1    88                                             ;--------------11  3 wait states
                      =1    89     
  07C3                =1    90     LMCSval        EQU     007C3H           ;LCS end at 07FFFFH, 3 wait states
                      =1    91                                             ;00--------------  reserved
                      =1    92                                             ;--00011111------  end address
                      =1    93                                             ;----------000---  reserved
                      =1    94                                             ;-------------0--  enable bus ready
                      =1    95                                             ;--------------11  3 wait states
                      =1    96     
  3003                =1    97     UMCSval        EQU     03003H           ;UCS base at F0000H, 3 wait states
                      =1    98                                             ;00--------------  reserved
                      =1    99                                             ;--11000000------  start address F0000
                      =1   100                                             ;----------000---  reserved
                      =1   101                                             ;-------------0--  enable bus ready
                      =1   102                                             ;--------------11  3 wait states
                      =1   103     
                      =1   104     
                      =1   105     
8086/87/88/186 MACRO ASSEMBLER    INITREG                                                  00:01:53  05/29/;6  PAGE    3


LOC  OBJ                  LINE     SOURCE

                      =1   106     
                      =1   107     
                      =1   108     
                      =1   109     
                      =1   110     
                      =1   111     
                      =1   112     
                      =1   113     
                      =1   114     
                      =1   115     
                           116     
                           117     
                           118     CGROUP    GROUP    CODE
                           119     
----                       120     CODE SEGMENT PUBLIC 'CODE'
                           121     
                           122             ASSUME  CS:CGROUP
                           123     
                           124     ; external function declarations
                           125     
                           126     
                           127     ;
                           128     ; InitCS
                           129     ;
                           130     ; Description:       Initialize the Peripheral Chip Selects on the 80188.
                           131     ;
                           132     ; Operation:         Write the initial values to the PACS and MPCS, MMCS,
                           133     ;                    LMCS, and UMCS values.
                           134     ;
                           135     ; Arguments:         None.
                           136     ; Return Value:      None.
                           137     ;
                           138     ; Local Variables:   None.
                           139     ; Shared Variables:  None.
                           140     ; Global Variables:  None.
                           141     ;
                           142     ; Input:             None.
                           143     ; Output:            None.
                           144     ;
                           145     ; Error Handling:    None.
                           146     ;
                           147     ; Algorithms:        None.
                           148     ; Data Structures:   None.
                           149     ;
                           150     ; Registers Changed: AX, DX
                           151     ;
                           152     ; Author:            Timothy Liu
                           153     ; Last Modified:     4/5/16
                           154     
0000                       155     InitCS  PROC    NEAR
                           156             PUBLIC  InitCS
                           157     
                           158     
0000 BAA4FF                159             MOV     DX, PACSreg     ;setup to write to PACS register
0003 B80300                160             MOV     AX, PACSval
8086/87/88/186 MACRO ASSEMBLER    INITREG                                                  00:01:53  05/29/;6  PAGE    4


LOC  OBJ                  LINE     SOURCE

0006 EE                    161             OUT     DX, AL          ;write PACSval to PACS
                           162     
0007 BAA8FF                163             MOV     DX, MPCSreg     ;setup to write to MPCS register
000A B88340                164             MOV     AX, MPCSval
000D EE                    165             OUT     DX, AL          ;write MPCSval to MPCS
                           166     
000E BAA6FF                167             MOV     DX, MMCSreg     ;setup to write to MPCS register
0011 B80380                168             MOV     AX, MMCSval
0014 EE                    169             OUT     DX, AL          ;write MPCSval to MPCS
                           170     
                           171     
0015 BAA0FF                172             MOV     DX, UMCSreg     ;setup to write to MPCS register
0018 B80330                173             MOV     AX, UMCSval
001B EE                    174             OUT     DX, AL          ;write MPCSval to MPCS
                           175     
                           176     
                           177     
001C C3                    178             RET                     ;done so return
                           179     
                           180     
                           181     InitCS  ENDP
                           182     
                           183     
                           184     ;
                           185     ; InitCon
                           186     ;
                           187     ; Description:       Initialize the control registers on the 80188.
                           188     ;
                           189     ; Operation:         Write the initial values to RELREG (PCB relocation),
                           190     ;                    RFBASE (refresh base address), RFTIME (refresh clock),
                           191     ;                    RFCON (Refresh Control), DxCON (DMAControl).
                           192     ;
                           193     ; Arguments:         None.
                           194     ; Return Value:      None.
                           195     ;
                           196     ; Local Variables:   None.
                           197     ; Shared Variables:  None.
                           198     ; Global Variables:  None.
                           199     ;
                           200     ; Input:             None.
                           201     ; Output:            None.
                           202     ;
                           203     ; Error Handling:    None.
                           204     ;
                           205     ; Algorithms:        None.
                           206     ; Data Structures:   None.
                           207     ;
                           208     ; Registers Changed: AX, DX
                           209     ;
                           210     ; Author:            Timothy Liu
                           211     ; Last Modified:     04/5/16
                           212     
                           213     ;InitCS  PROC    NEAR
                           214     ;        PUBLIC  InitCS
                           215     ;
8086/87/88/186 MACRO ASSEMBLER    INITREG                                                  00:01:53  05/29/;6  PAGE    5


LOC  OBJ                  LINE     SOURCE

                           216     ;
                           217     ;        MOV     DX, RELREGreg     ;setup to write to RELREG register
                           218     ;        MOV     AX, RELREGval
                           219     ;        OUT     DX, AL            ;write RELREGval to RELREG
                           220     ;
                           221     ;        MOV     DX, RFBASEreg     ;setup to write to RFBASE register
                           222     ;        MOV     AX, RFBASEval
                           223     ;        OUT     DX, AL            ;write RFBASEval to RFBASE
                           224     ;
                           225     ;        MOV     DX, RFTIMEreg     ;setup to write to RFTIME register
                           226     ;        MOV     AX, RFTIMEval
                           227     ;        OUT     DX, AL            ;write RFTIMEval to RFTIME
                           228     ;
                           229     ;        MOV     DX, RFCONreg      ;setup to write to RFCON register
                           230     ;        MOV     AX, RFCONval
                           231     ;        OUT     DX, AL            ;write RFCONval to RFCON
                           232     ;
                           233     ;        MOV     DX, DxCONreg      ;setup to write to DxCON register
                           234     ;        MOV     AX, DxCONval
                           235     ;        OUT     DX, AL            ;write DxCONval to DxCON
                           236     ;
                           237     ;
                           238     ;
                           239     ;        RET                     ;done so return
                           240     ;
                           241     ;
                           242     ;InitCS  ENDP
                           243     
                           244     
----                       245     CODE ENDS
                           246     
                           247     
                           248             END

ASSEMBLY COMPLETE, NO ERRORS FOUND
