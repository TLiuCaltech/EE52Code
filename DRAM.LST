8086/87/88/186 MACRO ASSEMBLER    DRAM                                                     18:26:38  05/11/;6  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE DRAM
OBJECT MODULE PLACED IN DRAM.OBJ
ASSEMBLER INVOKED BY:  C:\WINDOWS\SYSTEM32\ASM86.EXE DRAM.ASM M1 EP DB


LOC  OBJ                  LINE     SOURCE

                             1         NAME  DRAM
                             2     ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                             3     ;                                                                            ;
                             4     ;                                     DRAM                                   ;
                             5     ;                                 DRAM Functions                             ;
                             6     ;                                   EE/CS 52                                 ;
                             7     ;                                                                            ;
                             8     ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                             9     
                            10     ; Description:   This file contains the functions relating to the DRAM.
                            11     ;
                            12     
                            13     ; Table of Contents:
                            14     ;
                            15     ;        RefreshDRAM           -accesses PCS4 to trigger DRAM refresh
                            16     
                            17     ; Revision History:
                            18     ;
                            19     ;    5/6/16    Tim Liu    initial revision
                            20     ;
                            21     ;
                            22     
                            23     
                            24     ; local include files
                            25 +1  $INCLUDE(DRAM.INC)
                      =1    26     ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      =1    27     ;                                                                            ;
                      =1    28     ;                                   DRAM.INC                                 ;
                      =1    29     ;                             DRAM - MP3 includefile                         ;
                      =1    30     ;                                   EE/CS 52                                 ;
                      =1    31     ;                                                                            ;
                      =1    32     ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      =1    33     
                      =1    34     ; Description:   This function contains the definitions related to DRAM
                      =1    35     ;                refresh.
                      =1    36     
                      =1    37     
  0240                =1    38     PCS4Address        EQU        240H     ;address in PCS4 to trigger
                      =1    39                                            ;DRAM Refresh
                      =1    40     
  0020                =1    41     RefreshRows        EQU         32      ;number of rows to refresh for 
                      =1    42                                            ;call to RefreshDRAM
                      =1    43     
                            44     
                            45     CGROUP    GROUP    CODE
                            46     
                            47     
----                        48     CODE SEGMENT PUBLIC 'CODE'
                            49     
                            50             ASSUME  CS:CGROUP 
8086/87/88/186 MACRO ASSEMBLER    DRAM                                                     18:26:38  05/11/;6  PAGE    2


LOC  OBJ                  LINE     SOURCE

                            51     
                            52     ;external function declarations
                            53     
                            54     ;Name:               RefreshDRAM
                            55     ;
                            56     ;Description:        This function triggers a CAS before RAS refresh. The
                            57     ;                    function loops and reads PCS4Address RefreshRows
                            58     ;                    number of times. The function is called by
                            59     ;                    DRAMRefreshEH at every timer1 interrupt.
                            60     ; 
                            61     ;Operation:          The function first saves the registers. It then loads
                            62     ;                    the constant RefreshRows into BX. RefreshRows is the
                            63     ;                    number of rows that will be refreshed with each
                            64     ;                    call to RefreshDRAM. The function then loops
                            65     ;                    and reads from PCS4Address RefreshRows times. The
                            66     ;                    function then restores the registers and returns.
                            67     ;
                            68     ;Arguments:          None
                            69     ;
                            70     ;Return Values:      None
                            71     ;
                            72     ;Local Variables:    BX - number of rows left to refresh
                            73     ;
                            74     ;Shared Variables:   None
                            75     ;
                            76     ;Output:             None
                            77     ;
                            78     ;Error Handling:     None
                            79     ;
                            80     ;Algorithms:         None
                            81     ;
                            82     ;Registers Used:     AX, BX, DX
                            83     ;
                            84     ;Known Bugs:         None
                            85     ;
                            86     ;Limitations:        None
                            87     ;
                            88     ;Author:             Timothy Liu
                            89     ;
                            90     ;Last Modified       5/6/16
                            91     
0000                        92     RefreshDRAM        PROC    NEAR
                            93                        PUBLIC  RefreshDRAM
                            94     
0000                        95     RefreshDRAMStart:                    ;starting label
                            96                                          ;registers saved by event handler
0000 BB2000                 97         MOV     BX, RefreshRows          ;load number of rows left to refresh
0003 BA4002                 98         MOV     DX, PCS4Address          ;load address to read from
                            99     
0006                       100     RefreshDRAMLoop:                     ;loop reading PCS4Address
0006 83FB00                101         CMP    BX, 0                     ;check if no rows left to refresh
0009 7404                  102         JE     RefreshDRAMDone           ;no rows left - done with function
000B ED                    103         IN     AX, DX                    ;read PCS4 to trigger refresh
000C 4B                    104         DEC    BX                        ;one fewer road left to refresh
000D EBF7                  105         JMP    RefreshDRAMLoop           ;keep looping
8086/87/88/186 MACRO ASSEMBLER    DRAM                                                     18:26:38  05/11/;6  PAGE    3


LOC  OBJ                  LINE     SOURCE

                           106     
000F                       107     RefreshDRAMDone:                     ;done refreshing - registers saved by EH
000F C3                    108         RET
                           109     
                           110     
                           111     RefreshDRAM        ENDP
                           112     
                           113     
                           114     
----                       115     CODE ENDS
                           116     
                           117             END

ASSEMBLY COMPLETE, NO ERRORS FOUND
